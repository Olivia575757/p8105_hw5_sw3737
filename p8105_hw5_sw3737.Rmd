---
title: "p8105_hw5_sw3737"
author: "Shiqi Wu"
date: "2023-11-14"
output: github_document
---

```{r setup, include=FALSE}
library(purrr)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
library(broom)
```

# Problem 1

## Creating a Dataframe and Binding the Data
```{r}
file_names <- list.files(path = "data", pattern = "*.csv", full.names = TRUE)

combined_data <- map_df(file_names, function(file_name) {
  data <- read_csv(file_name)
  
  data <- data %>%
    mutate(
      arm = ifelse(grepl("con", file_name), "control", "experimental"),
      subject_id = gsub(".*_(\\d+).csv", "\\1", basename(file_name))
    )

  return(data)
})
```

## Tidying the Data
```{r}
tidy_data <- combined_data %>%
  pivot_longer(
    cols = starts_with("week"), 
    names_to = "week", 
    values_to = "observation"
  )
```

## Creating a Spaghetti Plot
```{r}
ggplot(tidy_data, aes(x = week, y = observation, group = interaction(arm, subject_id), color = arm)) +
  geom_line() +
  scale_color_manual(values = c("control" = "pink", "experimental" = "lightblue")) +
  labs(title = "Observations Over Time by Subject",
       x = "Week",
       y = "Observation",
       color = "Group") +
  theme_minimal()
```

Comment: The spaghetti plot suggests a divergence in trajectories between the control and experimental groups over time, with the experimental group showing an upward trend, indicating a potential effect of the treatment. In contrast, the control group's measurements remain relatively constant. The variability within the experimental group is also noticeably greater, implying a varied response to the intervention across different subjects.

# Problem 3

## Defining Parameters
```{r}
set.seed(123)  

n <- 30
sigma <- 5
mu_values <- 0:6
alpha <- 0.05
num_datasets <- 5000
```

## Simulating Datasets and Conducting t-tests
```{r}
results <- data.frame(mu = numeric(), p_value = numeric(), mu_hat = numeric(), reject_null = logical())

for (mu in mu_values) {
  for (i in 1:num_datasets) {
    sample_data <- rnorm(n, mean = mu, sd = sigma)
    test_result <- broom::tidy(t.test(sample_data, mu = 0))
    mu_hat <- test_result$estimate
    p_value <- test_result$p.value
    reject_null <- p_value < alpha
    results <- rbind(results, data.frame(mu, p_value, mu_hat, reject_null))
  }
}
```

